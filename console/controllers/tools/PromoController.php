<?php/** * php ./yii tools/promo/999-on * php ./yii tools/promo/999-off */namespace console\controllers\tools;use console\controllers\export\ExportController;use skeeks\cms\agent\models\CmsAgent;use skeeks\cms\components\Cms;/** * Class PromoController * @package console\controllers */class PromoController extends ExportController{    /**     * Активировать 999 (Деактивировать агенты для акции 999)     */    public function action999On()    {        $data = [            'imports/media-plan/all' => [                'agent_interval' => HOUR_2,                'active' => Cms::BOOL_Y            ],            'sync/element-properties --syncMode=new' => [                'agent_interval' => HOUR_2,                'active' => Cms::BOOL_Y            ],            'sync/element-properties/product-names' => [                'agent_interval' => HOUR_2,                'active' => Cms::BOOL_N            ],            'sync/promo/shop-discount' => [                'agent_interval' => HOUR_3,                'active' => Cms::BOOL_N            ],            'sync/promo/promo' => [                'agent_interval' => HOUR_3,                'active' => Cms::BOOL_N            ],            'sync/items' => [                'agent_interval' => HOUR_3,                'active' => Cms::BOOL_Y            ],            'sync/core/data' => [                'agent_interval' => HOUR_3,                'active' => Cms::BOOL_Y            ],            'sync/photos' => [                'agent_interval' => HOUR_3,                'active' => Cms::BOOL_Y            ],            'imports/look-book/import' => [                'agent_interval' => HOUR_6,                'active' => Cms::BOOL_N            ],            'sync/element-properties --syncMode=full' => [                'agent_interval' => DAYS_1,                'active' => Cms::BOOL_N            ],            'sync/prices' => [                'agent_interval' => HOUR_6,                'active' => Cms::BOOL_Y            ],            'export/yandex-products/feed' => [                'agent_interval' => HOUR_6,                'active' => Cms::BOOL_Y            ],            'export/yandex-products/site-map' => [                'agent_interval' => DAYS_1,                'active' => Cms::BOOL_N            ],            'statistics/main/products' => [                'agent_interval' => DAYS_1,                'active' => Cms::BOOL_Y            ],            'statistics/main/rating' => [                'agent_interval' => DAYS_1,                'active' => Cms::BOOL_Y            ],            'alerts/orders/sales-alert-day-hour' => [                'agent_interval' => DAYS_1,                'active' => Cms::BOOL_N            ],            'alerts/orders/sales-alert-day-part' => [                'agent_interval' => DAYS_1,                'active' => Cms::BOOL_N            ],            'alerts/orders/sales-alert-week-part' => [                'agent_interval' => DAYS_1,                'active' => Cms::BOOL_N            ],            'export/yandex-products/feed-google' => [                'agent_interval' => DAYS_1,                'active' => Cms::BOOL_N            ],            'statistics/main/set-view-product' => [                'agent_interval' => MIN_10,                'active' => Cms::BOOL_Y            ],            'sync/core/data/sync-brands' => [                'agent_interval' => DAYS_2,                'active' => Cms::BOOL_N            ],            'sync/element-properties/sync-prop  VIDEO_PRICE_TODAY --syncMode=full' => [                'agent_interval' => HOUR_1,                'active' => Cms::BOOL_N            ],            'sync/promo/winners' => [                'agent_interval' => MIN_10,                'active' => Cms::BOOL_N            ],            'test/gt-metrix/run' => [                'agent_interval' => HOUR_2,                'active' => Cms::BOOL_Y            ],            'export/orders/abandoned-baskets' => [                'agent_interval' => MIN_30,                'active' => Cms::BOOL_Y            ],        ];        $agents = CmsAgent::find()            ->andWhere(['IN', 'name', array_keys($data)])            ->all();        /**         * @var $agent CmsAgent         */        foreach ($agents as $agent) {            $agent->agent_interval = $data[$agent->name]['agent_interval'];            $agent->active = $data[$agent->name]['active'];            $agent->save();        }    }    /**     * Деактивировать 999 (Активировать агенты для нормальной работы)     */    public function action999Off()    {        $data = [            'imports/media-plan/all' => [                'agent_interval' => MIN_30,                'active' => Cms::BOOL_Y            ],            'sync/element-properties --syncMode=new' => [                'agent_interval' => HOUR_1,                'active' => Cms::BOOL_Y            ],            'sync/element-properties/product-names' => [                'agent_interval' => HOUR_2,                'active' => Cms::BOOL_Y            ],            'sync/promo/shop-discount' => [                'agent_interval' => HOUR_1,                'active' => Cms::BOOL_Y            ],            'sync/promo/promo' => [                'agent_interval' => HOUR_1,                'active' => Cms::BOOL_Y            ],            'sync/items' => [                'agent_interval' => HOUR_2,                'active' => Cms::BOOL_Y            ],            'sync/core/data' => [                'agent_interval' => HOUR_1,                'active' => Cms::BOOL_Y            ],            'sync/photos' => [                'agent_interval' => HOUR_1,                'active' => Cms::BOOL_Y            ],            'imports/look-book/import' => [                'agent_interval' => HOUR_6,                'active' => Cms::BOOL_Y            ],            'sync/element-properties --syncMode=full' => [                'agent_interval' => DAYS_1,                'active' => Cms::BOOL_N //т.к. переведено на крон            ],            'sync/prices' => [                'agent_interval' => HOUR_1,                'active' => Cms::BOOL_Y            ],            'export/yandex-products/feed' => [                'agent_interval' => HOUR_6,                'active' => Cms::BOOL_Y            ],            'export/yandex-products/site-map' => [                'agent_interval' => DAYS_1,                'active' => Cms::BOOL_Y            ],            'statistics/main/products' => [                'agent_interval' => HOUR_2,                'active' => Cms::BOOL_Y            ],            'statistics/main/rating' => [                'agent_interval' => HOUR_1,                'active' => Cms::BOOL_Y            ],            'alerts/orders/sales-alert-day-hour' => [                'agent_interval' => MIN_30,                'active' => Cms::BOOL_Y            ],            'alerts/orders/sales-alert-day-part' => [                'agent_interval' => MIN_30,                'active' => Cms::BOOL_Y            ],            'alerts/orders/sales-alert-week-part' => [                'agent_interval' => MIN_30,                'active' => Cms::BOOL_Y            ],            'export/yandex-products/feed-google' => [                'agent_interval' => HOUR_6,                'active' => Cms::BOOL_Y            ],            'statistics/main/set-view-product' => [                'agent_interval' => MIN_5,                'active' => Cms::BOOL_Y            ],            'sync/core/data/sync-brands' => [                'agent_interval' => DAYS_2,                'active' => Cms::BOOL_Y            ],            'sync/element-properties/sync-prop  VIDEO_PRICE_TODAY --syncMode=full' => [                'agent_interval' => HOUR_1,                'active' => Cms::BOOL_Y            ],            'sync/promo/winners' => [                'agent_interval' => MIN_10,                'active' => Cms::BOOL_N            ],            'test/gt-metrix/run' => [                'agent_interval' => HOUR_1,                'active' => Cms::BOOL_Y            ],            'export/orders/abandoned-baskets' => [                'agent_interval' => MIN_30,                'active' => Cms::BOOL_Y            ],        ];        $agents = CmsAgent::find()            ->andWhere(['IN', 'name', array_keys($data)])            ->all();        /**         * @var $agent CmsAgent         */        foreach ($agents as $agent) {            $agent->agent_interval = $data[$agent->name]['agent_interval'];            $agent->active = $data[$agent->name]['active'];            $agent->save();        }    }}